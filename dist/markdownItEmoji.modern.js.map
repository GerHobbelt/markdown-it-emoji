{"version":3,"file":"markdownItEmoji.modern.js","sources":["../lib/data/shortcuts.js","../lib/render.js","../lib/replace.js","../lib/normalize_opts.js","../index.js"],"sourcesContent":["// Emoticons -> Emoji mapping.\n//\n// (!) Some patterns skipped, to avoid collisions\n// without increase matcher complicity. Than can change in future.\n//\n// Places to look for more emoticons info:\n//\n// - http://en.wikipedia.org/wiki/List_of_emoticons#Western\n// - https://github.com/wooorm/emoticon/blob/master/Support.md\n// - http://factoryjoe.com/projects/emoticons/\n//\n\nexport default {\n  angry:            [ '>:(', '>:-(' ],\n  blush:            [ ':\")', ':-\")' ],\n  broken_heart:     [ '</3', '<\\\\3' ],\n  // :\\ and :-\\ not used because of conflict with markdown escaping\n  confused:         [ ':/', ':-/' ], // twemoji shows question\n  cry:              [ \":'(\", \":'-(\", ':,(', ':,-(' ],\n  frowning:         [ ':(', ':-(' ],\n  heart:            [ '<3' ],\n  imp:              [ ']:(', ']:-(' ],\n  innocent:         [ 'o:)', 'O:)', 'o:-)', 'O:-)', '0:)', '0:-)' ],\n  joy:              [ \":')\", \":'-)\", ':,)', ':,-)', \":'D\", \":'-D\", ':,D', ':,-D' ],\n  kissing:          [ ':*', ':-*' ],\n  laughing:         [ 'x-)', 'X-)' ],\n  neutral_face:     [ ':|', ':-|' ],\n  open_mouth:       [ ':o', ':-o', ':O', ':-O' ],\n  rage:             [ ':@', ':-@' ],\n  smile:            [ ':D', ':-D' ],\n  smiley:           [ ':)', ':-)' ],\n  smiling_imp:      [ ']:)', ']:-)' ],\n  sob:              [ \":,'(\", \":,'-(\", ';(', ';-(' ],\n  stuck_out_tongue: [ ':P', ':-P' ],\n  sunglasses:       [ '8-)', 'B-)' ],\n  sweat:            [ ',:(', ',:-(' ],\n  sweat_smile:      [ ',:)', ',:-)' ],\n  unamused:         [ ':s', ':-S', ':z', ':-Z', ':$', ':-$' ],\n  wink:             [ ';)', ';-)' ]\n};\n","\nexport default function emoji_html(tokens, idx /*, options, env */) {\n  return tokens[idx].content;\n}\n","// Emojies & shortcuts replacement logic.\n//\n// Note: In theory, it could be faster to parse :smile: in inline chain and\n// leave only shortcuts here. But, who care...\n//\n\n\nexport default function create_rule(md, emojies, shortcuts, scanRE, replaceRE) {\n  let arrayReplaceAt = md.utils.arrayReplaceAt,\n      ucm = md.utils.lib.ucmicro,\n      ZPCc = new RegExp([ ucm.Z.source, ucm.P.source, ucm.Cc.source ].join('|'));\n\n  function splitTextToken(text, level, Token) {\n    let token, last_pos = 0, nodes = [];\n\n    text.replace(replaceRE, function (match, offset, src) {\n      let emoji_name;\n      // Validate emoji name\n      if (shortcuts.hasOwnProperty(match)) {\n        // replace shortcut with full name\n        emoji_name = shortcuts[match];\n\n        // Don't allow letters before any shortcut (as in no \":/\" in http://)\n        if (offset > 0 && !ZPCc.test(src[offset - 1])) {\n          return;\n        }\n\n        // Don't allow letters after any shortcut\n        if (offset + match.length < src.length && !ZPCc.test(src[offset + match.length])) {\n          return;\n        }\n      } else {\n        emoji_name = match.slice(1, -1);\n      }\n\n      // Add new tokens to pending list\n      if (offset > last_pos) {\n        token         = new Token('text', '', 0);\n        token.content = text.slice(last_pos, offset);\n        nodes.push(token);\n      }\n\n      token         = new Token('emoji', '', 0);\n      token.markup  = emoji_name;\n      token.content = emojies[emoji_name];\n      nodes.push(token);\n\n      last_pos = offset + match.length;\n    });\n\n    if (last_pos < text.length) {\n      token         = new Token('text', '', 0);\n      token.content = text.slice(last_pos);\n      nodes.push(token);\n    }\n\n    return nodes;\n  }\n\n  return function emoji_replace(state) {\n    let i, j, l, tokens, token,\n        blockTokens = state.tokens,\n        autolinkLevel = 0;\n\n    for (j = 0, l = blockTokens.length; j < l; j++) {\n      if (blockTokens[j].type !== 'inline') { continue; }\n      tokens = blockTokens[j].children;\n\n      // We scan from the end, to keep position when new tags added.\n      // Use reversed logic in links start/end match\n      for (i = tokens.length - 1; i >= 0; i--) {\n        token = tokens[i];\n\n        if (token.type === 'link_open' || token.type === 'link_close') {\n          if (token.info === 'auto') { autolinkLevel -= token.nesting; }\n        }\n\n        if (token.type === 'text' && autolinkLevel === 0 && scanRE.test(token.content)) {\n          // replace current node\n          blockTokens[j].children = tokens = arrayReplaceAt(\n            tokens, i, splitTextToken(token.content, token.level, state.Token)\n          );\n        }\n      }\n    }\n  };\n}\n","// Convert input options to more useable format\n// and compile search regexp\n\n\nfunction quoteRE(str) {\n  return str.replace(/[.?*+^$[\\]\\\\(){}|-]/g, '\\\\$&');\n}\n\n\nexport default function normalize_opts(options) {\n  let emojies = options.defs,\n      shortcuts;\n\n  // Filter emojies by whitelist, if needed\n  if (options.enabled.length) {\n    emojies = Object.keys(emojies).reduce(function (acc, key) {\n      if (options.enabled.indexOf(key) >= 0) {\n        acc[key] = emojies[key];\n      }\n      return acc;\n    }, {});\n  }\n\n  // Flatten shortcuts to simple object: { alias: emoji_name }\n  shortcuts = Object.keys(options.shortcuts).reduce(function (acc, key) {\n    // Skip aliases for filtered emojies, to reduce regexp\n    if (!emojies[key]) { return acc; }\n\n    if (Array.isArray(options.shortcuts[key])) {\n      options.shortcuts[key].forEach(function (alias) {\n        acc[alias] = key;\n      });\n      return acc;\n    }\n\n    acc[options.shortcuts[key]] = key;\n    return acc;\n  }, {});\n\n  // Compile regexp\n  let names = Object.keys(emojies)\n    .map(function (name) { return ':' + name + ':'; })\n    .concat(Object.keys(shortcuts))\n    .sort()\n    .reverse()\n    .map(function (name) { return quoteRE(name); })\n    .join('|');\n  let scanRE = RegExp(names);\n  let replaceRE = RegExp(names, 'g');\n\n  return {\n    defs: emojies,\n    shortcuts: shortcuts,\n    scanRE: scanRE,\n    replaceRE: replaceRE\n  };\n}\n","\nimport emojies_defs from './lib/data/full.json';\nimport emojies_shortcuts from './lib/data/shortcuts';\nimport emoji_html from './lib/render';\nimport create_rule from './lib/replace';\nimport normalize_opts from './lib/normalize_opts';\n\n\nexport default function emoji_plugin(md, options) {\n  let defaults = {\n    defs: emojies_defs,\n    shortcuts: emojies_shortcuts,\n    enabled: []\n  };\n\n  let opts = normalize_opts(md.utils.assign({}, defaults, options || {}));\n\n  md.renderer.rules.emoji = emoji_html;\n\n  md.core.ruler.push('emoji', create_rule(md, opts.defs, opts.shortcuts, opts.scanRE, opts.replaceRE));\n}\n"],"names":["angry","blush","broken_heart","confused","cry","frowning","heart","imp","innocent","joy","kissing","laughing","neutral_face","open_mouth","rage","smile","smiley","smiling_imp","sob","stuck_out_tongue","sunglasses","sweat","sweat_smile","unamused","wink","emoji_html","tokens","idx","content","create_rule","md","emojies","shortcuts","scanRE","replaceRE","arrayReplaceAt","utils","ucm","lib","ucmicro","ZPCc","RegExp","Z","source","P","Cc","join","splitTextToken","text","level","Token","token","last_pos","nodes","replace","match","offset","src","emoji_name","hasOwnProperty","test","length","slice","push","markup","emoji_replace","state","i","j","l","blockTokens","autolinkLevel","type","children","info","nesting","quoteRE","str","normalize_opts","options","defs","enabled","Object","keys","reduce","acc","key","indexOf","Array","isArray","forEach","alias","names","map","name","concat","sort","reverse","emoji_plugin","defaults","emojies_defs","emojies_shortcuts","opts","assign","renderer","rules","emoji","core","ruler"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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"}